mod network;
mod peer;

use peer::{PeerIndex, PeerScore};
use network::{generate_trust_matrix, Network};
use rand::thread_rng;

fn main() {
    let num_peers: PeerIndex = 4;
    let initial_trust_scores = vec![1f64 / num_peers as f64; num_peers as usize];
    dbg!(initial_trust_scores.clone());

    let rng = &mut thread_rng();

    // let c = generate_trust_matrix(num_peers, rng);

    let mc: Vec<Vec<f64>> = [
        [0.,	0.,	0.9333333333333333,	0.06666666666666667].to_vec(),
        [0.4727272727272727,	0.,	0.03636363636363636,	0.4909090909090909].to_vec(),
        [0.3695652173913043,	0.3695652173913043,	0.,	0.2608695652173913].to_vec(),
        [0.15625,	0.4375,	0.40625,	0.].to_vec(),
    ].to_vec();

    let mut network = Network::new(num_peers, initial_trust_scores);

    network.connect_peers(mc);

    while !network.is_converged() {
        network.tick(rng);
    }

    let global_trust_scores = network.get_global_trust_scores();

    println!("{:?}", global_trust_scores);
}

// new_ti =  0.75
// self.last_cij_ti =  {1: 0.0, 2: 0.7, 3: 0.05}
// diff =  0.75
// new_ti =  0.5
// self.last_cij_ti =  {0: 0.23636363636363636, 2: 0.01818181818181818, 3: 0.24545454545454545}
// diff =  0.5
// new_ti =  0.9681818181818181
// self.last_cij_ti =  {0: 0.3578063241106719, 1: 0.3578063241106719, 3: 0.2525691699604743}
// diff =  0.9681818181818181
// new_ti =  0.5480237154150198
// self.last_cij_ti =  {0: 0.08562870553359685, 1: 0.23976037549407117, 2: 0.22263463438735182}
// diff =  0.5480237154150198
// new_ti =  0.6797986660079051
// self.last_cij_ti =  {1: 0.0, 2: 0.6344787549407114, 3: 0.04531991106719367}
// diff =  0.07020133399209494
// new_ti =  0.5975666996047431
// self.last_cij_ti =  {0: 0.2824860761767876, 2: 0.021729698167445202, 3: 0.2933509252605102}
// diff =  0.09756669960474307
// new_ti =  0.8788430874955084
// self.last_cij_ti =  {0: 0.32478983668312267, 1: 0.32478983668312267, 3: 0.22926341412926307}
// diff =  0.08933873068630971
// new_ti =  0.567934250456967
// self.last_cij_ti =  {0: 0.08873972663390109, 1: 0.24847123457492307, 2: 0.23072328924814284}
// diff =  0.019910535041947175
// new_ti =  0.6960156394938114
// self.last_cij_ti =  {1: 0.0, 2: 0.6496145968608906, 3: 0.04640104263292076}
// diff =  0.01621697348590634
// new_ti =  0.5732610712580457
// self.last_cij_ti =  {0: 0.27099614277653067, 2: 0.020845857136656206, 3: 0.2814190713448588}
// diff =  0.02430562834669736
// new_ti =  0.9011837432456897
// self.last_cij_ti =  {0: 0.3330461659821027, 1: 0.3330461659821027, 3: 0.23509141128148428}
// diff =  0.022340655750181293
// new_ti =  0.5629115252592638
// self.last_cij_ti =  {0: 0.08795492582175997, 1: 0.2462737923009279, 2: 0.2286828071365759}
// diff =  0.005022725197703193
// new_ti =  0.6919972345803933
// self.last_cij_ti =  {1: 0.0, 2: 0.6458640856083671, 3: 0.04613314897202622}
// diff =  0.004018404913418094
// new_ti =  0.5793199582830306
// self.last_cij_ti =  {0: 0.2738603439156145, 2: 0.021066180301201113, 3: 0.28439343406621503}
// diff =  0.006058887024984916
// new_ti =  0.895613073046144
// self.last_cij_ti =  {0: 0.3309874400387923, 1: 0.3309874400387923, 3: 0.2336381929685593}
// diff =  0.005570670199545713
// new_ti =  0.5641647760068005
// self.last_cij_ti =  {0: 0.08815074625106258, 1: 0.2468220895029752, 2: 0.22919194025276268}
// diff =  0.0012532507475366828
// new_ti =  0.6929985302054694
// self.last_cij_ti =  {1: 0.0, 2: 0.6467986281917715, 3: 0.04619990201369796}
// diff =  0.0010012956250761151
// new_ti =  0.5778095295417676
// self.last_cij_ti =  {0: 0.2731463230561083, 2: 0.021011255619700638, 3: 0.2836519508659586}
// diff =  0.001510428741263059
// new_ti =  0.8970018240642348
// self.last_cij_ti =  {0: 0.33150067411069545, 1: 0.33150067411069545, 3: 0.23400047584284386}
// diff =  0.0013887510180907725
// new_ti =  0.5638523287225005
// self.last_cij_ti =  {0: 0.0881019263628907, 1: 0.24668539381609395, 2: 0.2290650085435158}
// diff =  0.00031244728430002144
// new_ti =  0.6927489235296945
// self.last_cij_ti =  {1: 0.0, 2: 0.6465656619610483, 3: 0.0461832615686463}
// diff =  0.0002496066757748938
// new_ti =  0.5781860679267894
// self.last_cij_ti =  {0: 0.2733243230199368, 2: 0.021024947924610522, 3: 0.28383679698224207}
// diff =  0.00037653838502182957
// new_ti =  0.8966556184291745
// self.last_cij_ti =  {0: 0.3313727285499123, 1: 0.3313727285499123, 3: 0.23391016132934986}
// diff =  0.00034620563506027047

// [src/peer.rs:50] new_ti = 0.0
// [src/peer.rs:57] &self.last_cij_ti = {
//     1: 0.0,
//     3: 0.0,
//     2: 0.0,
// }
// [src/peer.rs:60] diff = 0.0
// [src/peer.rs:50] new_ti = 0.25
// [src/peer.rs:57] &self.last_cij_ti = {
//     2: 0.00909090909090909,
//     3: 0.12272727272727273,
//     0: 0.11818181818181818,
// }
// [src/peer.rs:60] diff = 0.25
// [src/peer.rs:50] new_ti = 0.5
// [src/peer.rs:57] &self.last_cij_ti = {
//     0: 0.18478260869565216,
//     1: 0.18478260869565216,
//     3: 0.13043478260869565,
// }
// [src/peer.rs:60] diff = 0.5
// [src/peer.rs:50] new_ti = 0.75
// [src/peer.rs:57] &self.last_cij_ti = {
//     1: 0.328125,
//     0: 0.1171875,
//     2: 0.3046875,
// }
// [src/peer.rs:60] diff = 0.75
// [src/peer.rs:50] new_ti = 0.0
// [src/peer.rs:57] &self.last_cij_ti = {
//     1: 0.0,
//     3: 0.0,
//     2: 0.0,
// }
// [src/peer.rs:60] diff = 0.0
// [src/peer.rs:50] new_ti = 0.25
// [src/peer.rs:57] &self.last_cij_ti = {
//     2: 0.00909090909090909,
//     3: 0.12272727272727273,
//     0: 0.11818181818181818,
// }
// [src/peer.rs:60] diff = 0.25
// [src/peer.rs:50] new_ti = 0.5
// [src/peer.rs:57] &self.last_cij_ti = {
//     0: 0.18478260869565216,
//     1: 0.18478260869565216,
//     3: 0.13043478260869565,
// }
// [src/peer.rs:60] diff = 0.5
// [src/peer.rs:50] new_ti = 0.75
// [src/peer.rs:57] &self.last_cij_ti = {
//     1: 0.328125,
//     0: 0.1171875,
//     2: 0.3046875,
// }
// [src/peer.rs:60] diff = 0.75
// [src/peer.rs:50] new_ti = 0.0
// [src/peer.rs:57] &self.last_cij_ti = {
//     1: 0.0,
//     3: 0.0,
//     2: 0.0,
// }
// [src/peer.rs:60] diff = 0.0
// [src/peer.rs:50] new_ti = 0.25
// [src/peer.rs:57] &self.last_cij_ti = {
//     2: 0.00909090909090909,
//     3: 0.12272727272727273,
//     0: 0.11818181818181818,
// }
// [src/peer.rs:60] diff = 0.25
// [src/peer.rs:50] new_ti = 0.5
// [src/peer.rs:57] &self.last_cij_ti = {
//     0: 0.18478260869565216,
//     1: 0.18478260869565216,
//     3: 0.13043478260869565,
// }
// [src/peer.rs:60] diff = 0.5
// [src/peer.rs:50] new_ti = 0.75
// [src/peer.rs:57] &self.last_cij_ti = {
//     1: 0.328125,
//     0: 0.1171875,
//     2: 0.3046875,
// }